import{_ as e}from"./page-container-2db7eecf.js";import{p as a}from"./p-center-modal-84ed26df.js";import"./dayjs-c306acb6.js";import{a6 as t,z as l,a7 as s,a8 as o,a9 as i,aa as r,ab as n,ac as p}from"./index-5edb5878.js";import{N as d,k as u,w as m,f,a4 as c,a6 as b,c as v,u as j,a8 as _,L as h,a3 as g,r as y,i as x,F as w,_ as C}from"./@vue-11129043.js";import{al as k}from"./@ant-design-477981d5.js";import{m as D}from"./ant-design-vue-93fc40b2.js";import"./pinia-1ca0c29b.js";import"./vue-demi-a81ff0a7.js";import"./store-8e5b6e13.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";import"./@babel-eab0ef53.js";import"./axios-93d3568f.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";const U=h(" 上传 "),O=h("取消"),A=h("提交"),F={__name:"restorePop",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(e,{emit:l}){const s=e,{visible:o,dataObj:i}=d(s),r=()=>{l("update:visible",!1)},n=u({file:[]}),p={file:[{required:!0,trigger:"change",message:"请上传恢复文件"}]},h=e=>!1,y=e=>{},x=(...e)=>{},w={labelCol:{span:7},wrapperCol:{span:15}},C=e=>{let a={id:i.value.start},s=new FormData;s.append("file",n.file[0].originFileObj),t({splicingData:a,data:s}).then((()=>{D.success("操作已进入任务队列, 请稍后前往青龙面板查看结果"),l("updateData"),r()}))};m(o,((e,a,t)=>{o.value&&F()}));const F=()=>{n.file=[]};return(e,t)=>{const l=g("a-button"),s=g("a-upload"),i=g("a-form-item"),d=g("a-divider"),u=g("a-form");return f(),c(a,{modalVisible:j(o),isFooter:!1,onClose:r,title:"备份恢复"},{content:b((()=>[v(u,_({ref:"formRef",name:"custom-validation",model:n,rules:p},w,{onValidate:x,onFinishFailed:y,onFinish:C}),{default:b((()=>[v(i,{label:"恢复文件",name:"file"},{default:b((()=>[v(s,{fileList:n.file,"onUpdate:fileList":t[0]||(t[0]=e=>n.file=e),"max-count":1,"before-upload":h},{default:b((()=>[v(l,null,{default:b((()=>[v(j(k)),U])),_:1})])),_:1},8,["fileList"])])),_:1}),v(d),v(i,{"wrapper-col":{span:12,offset:12},class:"timed-start-button"},{default:b((()=>[v(l,{onClick:r},{default:b((()=>[O])),_:1}),v(l,{type:"primary",style:{"margin-left":"20px"},"html-type":"submit"},{default:b((()=>[A])),_:1})])),_:1})])),_:1},16,["model"])])),_:1},8,["modalVisible"])}}},B={class:"flex form-container"},I={class:"flex-base form-container-item"},N=C("p",null,"Tip: 迁移/复制功能需要至少添加两个面板地址才能正常使用",-1),S=C("p",null,"迁移: 将A面板的所有变量迁移到B面板, 迁移完成后会清空A面板变量 ",-1),L=C("p",null,"复制: 将A面板的所有变量复制到B面板, 复制完成后A面板变量不会变化",-1),T=h("迁移"),q=h("复制"),P={class:"flex-base form-right form-container-item"},V=C("p",null,"Tip: 备份/恢复功能将会以JSON文件实现",-1),z=C("p",null,"备份: 备份完成后会自动下载备份文件，下载完成十秒后。服务器自动删除服务端备份数据",-1),J=h("恢复: 恢复文件的文件名必须为"),R=h("【backup.json】"),W=h("备份"),Y=h("恢复"),E=h("同步"),G=C("p",null,"Tip: 错误日志会显示以上功能执行时发生的错误记录（只显示最新的十条记录）",-1),H={__name:"index",setup(a){const t=u({start:"",end:""}),d=u({type:"1"}),m=y([]),c=(e,a)=>a.label.indexOf(e)>=0,j=y(3),h=u({start:void 0,end:[]}),k=y([]),U=y([]),O={labelCol:{span:6},wrapperCol:{span:16}},A={labelCol:{span:4},wrapperCol:{span:18}},H=[{title:"发生时间",dataIndex:"UserID"},{title:"任务名称",dataIndex:"Username"},{title:"错误记录",dataIndex:"UserWxpusher"}],K=y([]),M=y({}),Q=y(!1),X=e=>{U.value=m.value.filter((a=>a.value!==e)),h.end.includes(e)&&(h.end=h.end.filter((a=>a!=e)))},Z=()=>{h.start?h.end.length?o({data:h}).then((()=>{h.start=void 0,h.end=[]})):D.error("请选择面板B!"):D.error("请选择面板A!")},$=()=>{Q.value=!0,M.value=d},ee=()=>{i({data:t}).then((()=>{D.success("操作已进入任务队列, 请稍后前往青龙面板查看结果!")}))},ae=()=>{r({data:t}).then((()=>{D.success("操作已进入任务队列, 请稍后前往青龙面板查看结果!")}))},te=()=>{n({data:d}).then((()=>{D.success("操作已进入任务队列, 完成后将自动下载备份文件!"),p()}))},le=()=>{s().then((e=>{K.value=e||[]}))};return l({data:{},splicingData:{page:1,quantity:100}}).then((e=>{m.value=e.pageData.map((e=>({label:e.PanelName,value:e.ID,envData:e.env_data}))),t.start=m.value[0].value,d.start=m.value[0].value;try{t.end=m.value[1].value}catch(a){t.end=m.value[0].value}k.value=m.value,U.value=m.value})),(a,l)=>{const s=g("a-card"),o=g("a-select"),i=g("a-form-item"),r=g("a-col"),n=g("a-row"),p=g("a-divider"),u=g("a-button"),y=g("a-form");return f(),x(w,null,[v(F,{visible:Q.value,"onUpdate:visible":l[0]||(l[0]=e=>Q.value=e),dataObj:M.value},null,8,["visible","dataObj"]),v(e,{isScroll:"",isNoYScroll:"",isTable:"",isNoPagination:"",columns:H,onInitData:le,dataSource:K.value},{top:b((()=>[C("div",B,[C("div",I,[v(s,{title:"迁移/复制",bordered:!1},{default:b((()=>[N,S,L])),_:1}),v(y,_({model:t},O),{default:b((()=>[v(n,null,{default:b((()=>[v(r,{span:11},{default:b((()=>[v(i,{label:"面板A:",name:"start"},{default:b((()=>[v(o,{value:t.start,"onUpdate:value":l[1]||(l[1]=e=>t.start=e),placeholder:"请选择","filter-option":c,"show-search":"","option-label-prop":"label",options:m.value},null,8,["value","options"])])),_:1})])),_:1}),v(r,{span:11},{default:b((()=>[v(i,{label:"面板B:",name:"end"},{default:b((()=>[v(o,{value:t.end,"onUpdate:value":l[2]||(l[2]=e=>t.end=e),placeholder:"请选择","filter-option":c,"show-search":"","option-label-prop":"label",options:m.value},null,8,["value","options"])])),_:1})])),_:1})])),_:1}),v(p),v(i,{"wrapper-col":{span:20,offset:2},class:"form-buttom flex"},{default:b((()=>[v(u,{type:"primary",style:{"margin-right":"20px"},class:"flex-base",onClick:ee},{default:b((()=>[T])),_:1}),v(u,{type:"primary",class:"flex-base",style:{width:"150px"},onClick:ae},{default:b((()=>[q])),_:1})])),_:1})])),_:1},16,["model"])]),C("div",P,[v(s,{title:"备份/恢复",bordered:!1},{default:b((()=>[V,z,C("p",null,[J,v(u,{type:"link",class:"cursor-initial",danger:""},{default:b((()=>[R])),_:1})])])),_:1}),v(y,_({model:d},A),{default:b((()=>[v(i,{label:"操作面板:",style:{"margin-top":"-10px"},name:"start"},{default:b((()=>[v(o,{value:d.start,"onUpdate:value":l[3]||(l[3]=e=>d.start=e),placeholder:"请选择","filter-option":c,"show-search":"","option-label-prop":"label",options:m.value},null,8,["value","options"])])),_:1}),v(p),v(i,{"wrapper-col":{span:20,offset:2},class:"form-buttom"},{default:b((()=>[v(u,{type:"primary",class:"flex-base",style:{"margin-right":"20px"},onClick:te},{default:b((()=>[W])),_:1}),v(u,{type:"primary",class:"flex-base",onClick:$},{default:b((()=>[Y])),_:1})])),_:1})])),_:1},16,["model"])])]),v(s,{title:"config.sh 同步",bordered:!1},{default:b((()=>[v(n,{gutter:16},{default:b((()=>[v(r,{span:5},{default:b((()=>[v(i,{label:"面板A:",name:"start"},{default:b((()=>[v(o,{value:h.start,"onUpdate:value":l[4]||(l[4]=e=>h.start=e),placeholder:"请选择","filter-option":c,"show-search":"",onChange:X,"option-label-prop":"label",options:k.value},null,8,["value","options"])])),_:1})])),_:1}),v(r,{span:13},{default:b((()=>[v(i,{label:"面板B:",name:"end"},{default:b((()=>[v(o,{value:h.end,"onUpdate:value":l[5]||(l[5]=e=>h.end=e),placeholder:"请选择","max-tag-count":j.value,"filter-option":c,"show-search":"",mode:"multiple","option-label-prop":"label",options:U.value},null,8,["value","max-tag-count","options"])])),_:1})])),_:1}),v(r,{span:6},{default:b((()=>[v(u,{type:"primary",style:{width:"100%"},onClick:Z},{default:b((()=>[E])),_:1})])),_:1})])),_:1})])),_:1}),v(s,{title:"错误日志",bordered:!1},{default:b((()=>[G])),_:1})])),_:1},8,["dataSource"])],64)}}};export{H as default};
