import{a as e,b as a,c as s,d as r,g as t,e as l,f as i}from"./index-e150f431.js";import{p as o}from"./p-center-modal-b39d0887.js";import"./dayjs-04e8f6f9.js";import{c as d}from"./store-bc016a64.js";import{a0 as n,a1 as u,a2 as p,a3 as c}from"./@ant-design-477981d5.js";import{N as m,q as v,k as f,r as b,w as g,f as w,a4 as y,a6 as _,c as h,u as x,$ as j,L as k,a3 as S,i as U,_ as C,a5 as z,a2 as F,F as q}from"./@vue-11129043.js";import{m as D}from"./ant-design-vue-05054bf0.js";import{s as P}from"./pinia-1ca0c29b.js";import"./axios-93d3568f.js";import"./@babel-eab0ef53.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";import"./vue-demi-a81ff0a7.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";const O=k(" 发送验证码（ "),I=k(" ） "),W=k(" 发送验证码"),B=k(" 登录 "),L={__name:"abnormal-login",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(s,{emit:r}){const t=s,{visible:l,dataObj:i}=m(t),c=()=>{r("update:visible",!1)},k=v((()=>!C.username||!C.password)),U=()=>{F.value=Date.now(),z.value=!1},C=f({username:"",password:"",id:""}),z=b(!1),F=b(Date.now()+6e4),q=()=>{C.username?e({data:{username:C.username}}).then((()=>{D.success("发送成功，请前往微信公众号【WxPusher】查看验证码"),F.value=Date.now()+6e4,z.value=!0})):D.error("请输入用户名")},P={username:{required:!0,message:"请输入用户名!"},password:{required:!0,message:"请输入密码!"},id:{required:!0,message:"请输入验证码!"}},L=e=>{},N=e=>{let s={username:C.username,password:C.password,id:C.id};a({data:s}).then((e=>{d.saveItem("token",e),D.success("登录成功"),d.getUserSmsInfo()})).catch((e=>{try{if(5017==e.code)return void q()}catch(a){}}))};g(l,((e,a,s)=>{l.value&&V()}));const V=()=>{C.username=i.value.username||"",C.password=i.value.password||"",C.id="",q()};return(e,a)=>{const s=S("a-input"),r=S("a-form-item"),t=S("a-statistic-countdown"),i=S("a-button"),d=S("a-input-password"),m=S("a-form");return w(),y(o,{modalVisible:x(l),isNoBg:"",isFooter:!1,onClose:c,title:"您的登录环境异常，需要校验身份"},{content:_((()=>[h(m,{model:C,rules:P,onFinish:N,onFinishFailed:L},{default:_((()=>[h(r,{name:"username"},{default:_((()=>[h(s,{value:C.username,"onUpdate:value":a[0]||(a[0]=e=>C.username=e),placeholder:"请输入用户名",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(n),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),_:1},8,["value"])])),_:1}),h(r,{name:"id"},{default:_((()=>[h(s,{value:C.id,"onUpdate:value":a[1]||(a[1]=e=>C.id=e),placeholder:"请输入验证码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(u),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),suffix:_((()=>[z.value?(w(),y(i,{key:0,class:"button-flex post-code align-center",disabled:""},{default:_((()=>[O,h(t,{value:F.value,format:"ss",onFinish:U},null,8,["value"]),I])),_:1})):(w(),y(i,{key:1,type:"primary",class:"button-flex post-code align-center",onClick:q},{default:_((()=>[W])),_:1}))])),_:1},8,["value"])])),_:1}),h(r,{name:"password"},{default:_((()=>[h(d,{value:C.password,"onUpdate:value":a[2]||(a[2]=e=>C.password=e),type:"password",placeholder:"请输入密码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(p),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),_:1},8,["value"])])),_:1}),h(r,{align:"middle"},{default:_((()=>[h(i,{type:"primary",style:{width:"100%"},"html-type":"submit",class:j(["login-button",x(k)?"disabled":""]),disabled:x(k)},{default:_((()=>[B])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modalVisible"])}}},N={class:"page-login bg-cover flex align-items"},V={class:"login-container flex"},M={key:0,class:"container-left flex-base flex flex-column align-items"},R=C("view",{class:"left-image bg-cover"},null,-1),T={class:"left-text font-weight"},$=C("text",{class:"left-small"},"简洁、方便的助手",-1),A={class:"container-right"},E=C("view",{class:"right-title flex align-items"},"欢迎登录",-1),G=k("邮箱找回"),H=k("用户名找回"),J=k(" 发送验证码（ "),K=k(" ） "),Q=k(" 发送验证码"),X=k(" 发送验证码"),Y={key:7,class:"login-register"},Z=k(" 没有账号? "),ee=k(" 忘记密码? "),ae={key:8,class:"login-register"},se=k(" 已有账号? "),re=k(" 忘记密码? "),te={key:9,class:"login-register"},le=k(" 已有账号? "),ie=k(" 没有账号? "),oe=k(" 登录 "),de=k(" 注册 "),ne=k(" 找回 "),ue={__name:"Login",setup(o){const{siteSettings:m,isMobile:g}=P(d),O=b(!1);d.getItem("token")&&d.checkUserToken().then().catch();const I=v((()=>!pe.username||!pe.password)),W=v((()=>!(pe.username&&pe.password&&pe.email&&pe.re_password&&pe.capt))),B=v((()=>"user"===pe.find_type?!(pe.find_type&&pe.code&&pe.capt&&pe.username):!(pe.find_type&&pe.code&&pe.capt&&pe.email)));const ue={email:{required:!0,type:"email",message:"请输入邮箱!"},username:{required:!0,message:"请输入用户名!"},password:{required:!0,message:"请输入密码!"},capt:{required:!0,message:"请输入!"},re_password:[{validator:async(e,a)=>""===a?Promise.reject("请输入确认密码!"):a!==pe.password?Promise.reject("两次密码输入不一致!"):Promise.resolve(),trigger:"change"}]},pe=f({code:"",find_type:"email",content:"",email:"",username:"",password:"",re_password:"",capt:"",id:""}),ce=b({}),me=b(!1),ve=b(!1),fe=b(Date.now()+6e4),be=()=>{pe.username?e({data:{username:pe.username}}).then((()=>{D.success("发送成功，请前往微信公众号【WxPusher】查看验证码"),fe.value=Date.now()+6e4,ve.value=!0})):D.error("请输入用户名")},ge=()=>{"user"!==pe.find_type||pe.username?"email"!==pe.find_type||pe.email?pe.capt?l({data:{find_type:pe.find_type,content:"user"===pe.find_type?pe.username:pe.email,capt:pe.capt,id:pe.id}}).then((()=>{D.success("发送成功，请前往微信公众号【WxPusher】查看验证码"),fe.value=Date.now()+6e4,ve.value=!0})):D.error("请输入校验码"):D.error("请输入邮箱"):D.error("请输入用户名")},we=()=>{fe.value=Date.now(),ve.value=!1},ye=e=>{switch(ke.value){case"login":Ue();break;case"register":he();break;default:_e()}},_e=()=>{s({data:{code:pe.code,password:pe.password}}).then((e=>{D.success("注册成功,请重新登录"),ke.value="login",pe.capt="",pe.code="",Ce()})).catch((()=>{Ce()}))},he=()=>{pe.password===pe.re_password?r({data:{email:pe.email,username:pe.username,password:pe.password,re_password:pe.re_password,capt:pe.capt,id:pe.id}}).then((e=>{D.success("注册成功,请登录"),pe.capt="",ke.value="login",Ce()})).catch((()=>{Ce()})):D.error("两次密码输入不一致")},xe=e=>{},je=b(""),ke=b("login"),Se=e=>{pe.email="",pe.username="",pe.password="",pe.code="",ke.value=e},Ue=()=>{let e={username:pe.username,password:pe.password,capt:pe.capt,id:pe.id},s=i;O.value&&(s=a,e={username:pe.username,password:pe.password,id:pe.code}),s({data:e}).then((e=>{d.saveItem("token",e),D.success("登录成功"),d.getUserSmsInfo()})).catch((e=>{try{if(5016==e.code)return me.value=!0,void(ce.value=pe)}catch(a){D.error(e.msg||"系统异常")}D.error(e.msg||"系统异常"),Ce()}))},Ce=()=>{t().then((e=>{je.value=e.bs64,pe.id=e.id}))};return Ce(),(e,a)=>{const s=S("a-radio"),r=S("a-radio-group"),t=S("a-form-item"),l=S("a-input"),i=S("a-image"),o=S("a-statistic-countdown"),v=S("a-button"),f=S("a-input-password"),b=S("a-form");return w(),U(q,null,[h(L,{visible:me.value,"onUpdate:visible":a[0]||(a[0]=e=>me.value=e),dataObj:ce.value},null,8,["visible","dataObj"]),C("view",N,[C("view",V,[x(g)?F("",!0):(w(),U("view",M,[R,C("view",T,[k(z(x(m).web_title||"青龙助手PRO")+" ",1),$])])),C("view",A,[E,h(b,{model:pe,rules:ue,onFinish:ye,onFinishFailed:xe},{default:_((()=>["retrieve"===ke.value?(w(),y(t,{key:0,label:"",name:"find_type",class:"form-findtype"},{default:_((()=>[h(r,{value:pe.find_type,"onUpdate:value":a[1]||(a[1]=e=>pe.find_type=e)},{default:_((()=>[h(s,{value:"email"},{default:_((()=>[G])),_:1}),h(s,{value:"user"},{default:_((()=>[H])),_:1})])),_:1},8,["value"])])),_:1})):F("",!0),"register"==ke.value||"retrieve"===ke.value&&"email"===pe.find_type?(w(),y(t,{key:1,name:"email"},{default:_((()=>[h(l,{value:pe.email,"onUpdate:value":a[2]||(a[2]=e=>pe.email=e),placeholder:"请输入邮箱",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(c),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),_:1},8,["value"])])),_:1})):F("",!0),"retrieve"!==ke.value||"retrieve"===ke.value&&"user"===pe.find_type?(w(),y(t,{key:2,name:"username"},{default:_((()=>[h(l,{value:pe.username,"onUpdate:value":a[3]||(a[3]=e=>pe.username=e),placeholder:"请输入用户名",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(n),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),_:1},8,["value"])])),_:1})):F("",!0),"retrieve"===ke.value?(w(),y(t,{key:3,name:"capt"},{default:_((()=>[h(l,{value:pe.capt,"onUpdate:value":a[4]||(a[4]=e=>pe.capt=e),placeholder:"请输入校验码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(u),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),suffix:_((()=>[h(i,{width:100,preview:!1,onClick:Ce,src:je.value},null,8,["src"])])),_:1},8,["value"])])),_:1})):F("",!0),"retrieve"===ke.value||O.value?(w(),y(t,{key:4,name:"code"},{default:_((()=>[h(l,{value:pe.code,"onUpdate:value":a[5]||(a[5]=e=>pe.code=e),placeholder:"请输入验证码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(u),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),suffix:_((()=>[ve.value?(w(),y(v,{key:0,class:"flex post-code align-center",disabled:""},{default:_((()=>[J,h(o,{value:fe.value,format:"ss",onFinish:we},null,8,["value"]),K])),_:1})):(w(),U(q,{key:1},[O.value?(w(),y(v,{key:0,type:"primary",class:"flex post-code align-center",onClick:be},{default:_((()=>[Q])),_:1})):(w(),y(v,{key:1,type:"primary",class:"flex post-code align-center",onClick:ge},{default:_((()=>[X])),_:1}))],64))])),_:1},8,["value"])])),_:1})):F("",!0),"retrieve"===ke.value||O.value?F("",!0):(w(),y(t,{key:5,name:"capt"},{default:_((()=>[h(l,{value:pe.capt,"onUpdate:value":a[6]||(a[6]=e=>pe.capt=e),placeholder:"请输入验证码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(u),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),suffix:_((()=>[h(i,{width:100,preview:!1,onClick:Ce,src:je.value},null,8,["src"])])),_:1},8,["value"])])),_:1})),h(t,{name:"password"},{default:_((()=>[h(f,{value:pe.password,"onUpdate:value":a[7]||(a[7]=e=>pe.password=e),type:"password",placeholder:"请输入密码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(p),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),_:1},8,["value"])])),_:1}),"register"===ke.value?(w(),y(t,{key:6,name:"re_password"},{default:_((()=>[h(f,{value:pe.re_password,"onUpdate:value":a[8]||(a[8]=e=>pe.re_password=e),placeholder:"请输入确认密码",bordered:!1,"allow-clear":""},{prefix:_((()=>[h(x(p),{style:{fontSize:"20px",color:"rgba(0, 0, 0, 0.25)"}})])),_:1},8,["value"])])),_:1})):F("",!0),"login"===ke.value?(w(),U("view",Y,[1==x(d).siteSettings.register?(w(),U(q,{key:0},[Z,C("text",{class:"register-button",onClick:a[9]||(a[9]=e=>Se("register"))},"注册")],64)):F("",!0),ee,C("text",{class:"register-button",onClick:a[10]||(a[10]=e=>Se("retrieve"))},"找回")])):F("",!0),"register"===ke.value?(w(),U("view",ae,[se,C("text",{class:"register-button",onClick:a[11]||(a[11]=e=>Se("login"))},"登录"),re,C("text",{class:"register-button",onClick:a[12]||(a[12]=e=>Se("retrieve"))},"找回")])):F("",!0),"retrieve"===ke.value?(w(),U("view",te,[le,C("text",{class:"register-button",onClick:a[13]||(a[13]=e=>Se("login"))},"登录"),1==x(d).siteSettings.register?(w(),U(q,{key:0},[ie,C("text",{class:"register-button",onClick:a[14]||(a[14]=e=>Se("register"))},"注册")],64)):F("",!0)])):F("",!0),h(t,{align:"middle"},{default:_((()=>["login"===ke.value?(w(),y(v,{key:0,type:"primary","html-type":"submit",class:j(["login-button",x(I)?"disabled":""]),disabled:x(I)},{default:_((()=>[oe])),_:1},8,["class","disabled"])):F("",!0),"register"===ke.value?(w(),y(v,{key:1,type:"primary","html-type":"submit",class:j(["login-button",x(W)?"disabled":""]),disabled:x(W)},{default:_((()=>[de])),_:1},8,["class","disabled"])):F("",!0),"retrieve"===ke.value?(w(),y(v,{key:2,type:"primary","html-type":"submit",class:j(["login-button",x(B)?"disabled":""]),disabled:x(B)},{default:_((()=>[ne])),_:1},8,["class","disabled"])):F("",!0)])),_:1})])),_:1},8,["model"])])])])],64)}}};export{ue as default};
