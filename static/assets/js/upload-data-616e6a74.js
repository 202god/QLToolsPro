import{s as e}from"./pinia-1ca0c29b.js";import{c as a}from"./store-bc016a64.js";import{_ as t}from"./_plugin-vue_export-helper-9b9a8a5b.js";import{d as l,N as n,r as s,o as i,a3 as v,f as u,i as o,_ as r,a5 as d,U as p,c,F as m,$ as f,k as h,a6 as g,a8 as b,L as y}from"./@vue-11129043.js";import{p as D,i as _,j as x}from"./index-e150f431.js";import{m as E}from"./ant-design-vue-05054bf0.js";const N=l({props:{isWatch:{type:Boolean,default:!0},title:{type:String,default:""},isLoad:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},data:{type:Array,default:[1]}},setup(t,l){const{siteSettings:v}=e(a),{title:u,isLoad:o,loading:r,data:d,isWatch:p}=n(t),c=s(null),m=s(0),f=s(0);return p.value&&(i((()=>{m.value=c.value.offsetHeight,f.value=c.value.offsetWidth})),window.addEventListener("resize",(()=>{c.value&&c.value.offsetHeight&&(m.value=0,setTimeout((()=>{m.value=c.value.offsetHeight,f.value=c.value.offsetWidth}),1e3))}))),{siteSettings:v,contentWidth:f,contentHeight:m,myRef:c,title:u,isLoad:o,loading:r}}}),C={class:"container-title"},k={class:"container-title-content"},w={class:"title-text flex content-between"},I={class:"tilte-left"},q={class:"container-table flex-base flex flex-column",ref:"myRef"},j={key:0,class:"load-spin flex align-items flex-base"},H={key:1,class:"flex-base flex align-items p-no-data"};const T=t(N,[["render",function(e,a,t,l,n,s){const i=v("a-spin"),h=v("a-empty");return u(),o("div",{class:f(["flex flex-column pc-container",e.siteSettings.web_bg?"pc-box-bg":""])},[r("div",C,[r("div",k,[r("div",w,[r("div",I,d(e.title),1),p(e.$slots,"title")])])]),r("div",q,[!e.contentHeight||e.isLoad&&e.loading?(u(),o("div",j,[c(i)])):(u(),o(m,{key:1},[e.contentHeight&&e.data.length?p(e.$slots,"content",{key:0,width:e.contentWidth,height:e.contentHeight}):(u(),o("div",H,[c(h)]))],64))],512)],2)}]]),U=y("提交"),L={__name:"upload-data",emits:["tipChange"],setup(e,{emit:a}){const t=s(!1),l=s(""),n=s(""),i=s(""),r={labelCol:{span:4},wrapperCol:{span:18}},d={serverID:[{required:!0,trigger:"change",message:"请输入服务器ID!"}],envName:[{required:!0,message:"请输入变量名!",trigger:"change"}]},p=s(0),f=s([]),y=s([]),N=h({serverID:"",envName:"",envData:""}),C=()=>{i.value?D({data:{cdk:i.value}}).then((e=>{E.success("更新CD-KEY密钥成功!"),t.value=!1})):E.error("请输入CD-KEY密钥！")},k=e=>{_({data:{server_id:N.serverID,env_name:N.envName,env_data:N.envData}}).then((e=>{E.success("变量提交成功")})).catch((e=>{}))},w=e=>{},I=(e,a)=>a.label.indexOf(e)>=0,q=(e,t)=>{N.envName="",p.value="";try{y.value=t.envData.map((e=>({label:e.EnvName,value:e.EnvName,quantity:e.EnvQuantity,EnvTips:e.EnvTips}))),N.envName=y.value[0].value,p.value=y.value[0].quantity,l.value=y.value[0].EnvTips,a("tipChange",l.value)}catch(n){}},j=(e,a)=>{p.value="",p.value=a.quantity};return x({}).then((e=>{f.value=e.online.map((e=>({label:e.PanelName,value:e.id,envData:e.env_data}))),N.serverID=f.value[0].value;try{y.value=f.value[0].envData.map((e=>({label:e.EnvName,value:e.EnvName,quantity:e.EnvQuantity,EnvTips:e.EnvTips}))),N.envName=y.value[0].value,p.value=y.value[0].quantity,l.value=y.value[0].EnvTips,a("tipChange",l.value)}catch(t){}})),(e,a)=>{const l=v("a-select"),s=v("a-form-item"),h=v("a-input"),D=v("a-textarea"),_=v("a-button"),x=v("a-form"),E=v("a-modal");return u(),o(m,null,[c(x,b({model:N,name:"basic"},r,{onFinish:k,rules:d,onFinishFailed:w}),{default:g((()=>[c(s,{label:"服务器:",name:"serverID"},{default:g((()=>[c(l,{value:N.serverID,"onUpdate:value":a[0]||(a[0]=e=>N.serverID=e),placeholder:"请选择","filter-option":I,"show-search":"",onChange:q,"option-label-prop":"label",options:f.value},null,8,["value","options"])])),_:1}),c(s,{label:"变量组:",name:"envName"},{default:g((()=>[c(l,{value:N.envName,"onUpdate:value":a[1]||(a[1]=e=>N.envName=e),placeholder:"请选择","filter-option":I,"show-search":"",onChange:j,"option-label-prop":"label",options:y.value},null,8,["value","options"])])),_:1}),c(s,{label:"剩余位置",name:"serverID","has-feedback":""},{default:g((()=>[c(h,{value:p.value,"onUpdate:value":a[2]||(a[2]=e=>p.value=e),disabled:!0},null,8,["value"])])),_:1}),c(s,{name:"envData",label:"变量值","has-feedback":"",rules:[{required:!0,message:"请输入变量值!"}]},{default:g((()=>[c(D,{value:N.envData,"onUpdate:value":a[3]||(a[3]=e=>N.envData=e),placeholder:"请输入变量值!"},null,8,["value"])])),_:1}),c(s,{"wrapper-col":{offset:4,span:18}},{default:g((()=>[c(_,{type:"primary","html-type":"submit"},{default:g((()=>[U])),_:1})])),_:1})])),_:1},16,["model"]),c(E,{visible:t.value,"onUpdate:visible":a[5]||(a[5]=e=>t.value=e),title:n.value,centered:"",onOk:C},{default:g((()=>[c(h,{value:i.value,"onUpdate:value":a[4]||(a[4]=e=>i.value=e),placeholder:"请输入CD-KEY密钥",size:"large"},null,8,["value"])])),_:1},8,["visible","title"])],64)}}};export{L as _,T as b};
