import{_ as e}from"./page-container-fd59b876.js";import{p as a}from"./p-center-modal-b39d0887.js";import"./dayjs-04e8f6f9.js";import{a5 as t,z as l,a6 as s,a7 as o,a8 as i,a9 as r,aa as p}from"./index-e150f431.js";import{N as n,k as d,w as u,f as m,a4 as f,a6 as c,c as b,u as v,a8 as j,L as _,a3 as h,r as g,i as y,F as x,_ as w}from"./@vue-11129043.js";import{al as C}from"./@ant-design-477981d5.js";import{m as D}from"./ant-design-vue-05054bf0.js";import"./pinia-1ca0c29b.js";import"./vue-demi-a81ff0a7.js";import"./store-bc016a64.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";import"./@babel-eab0ef53.js";import"./axios-93d3568f.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";const k=_(" 上传 "),O=_("取消"),U=_("提交"),F={__name:"restorePop",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(e,{emit:l}){const s=e,{visible:o,dataObj:i}=n(s),r=()=>{l("update:visible",!1)},p=d({file:[]}),_={file:[{required:!0,trigger:"change",message:"请上传恢复文件"}]},g=e=>!1,y=e=>{},x=(...e)=>{},w={labelCol:{span:7},wrapperCol:{span:15}},F=e=>{let a={id:i.value.start},s=new FormData;s.append("file",p.file[0].originFileObj),t({splicingData:a,data:s}).then((()=>{D.success("操作已进入任务队列, 请稍后前往青龙面板查看结果"),l("updateData"),r()}))};u(o,((e,a,t)=>{o.value&&I()}));const I=()=>{p.file=[]};return(e,t)=>{const l=h("a-button"),s=h("a-upload"),i=h("a-form-item"),n=h("a-divider"),d=h("a-form");return m(),f(a,{modalVisible:v(o),isFooter:!1,onClose:r,title:"备份恢复"},{content:c((()=>[b(d,j({ref:"formRef",name:"custom-validation",model:p,rules:_},w,{onValidate:x,onFinishFailed:y,onFinish:F}),{default:c((()=>[b(i,{label:"恢复文件",name:"file"},{default:c((()=>[b(s,{fileList:p.file,"onUpdate:fileList":t[0]||(t[0]=e=>p.file=e),"max-count":1,"before-upload":g},{default:c((()=>[b(l,null,{default:c((()=>[b(v(C)),k])),_:1})])),_:1},8,["fileList"])])),_:1}),b(n),b(i,{"wrapper-col":{span:12,offset:12},class:"timed-start-button"},{default:c((()=>[b(l,{onClick:r},{default:c((()=>[O])),_:1}),b(l,{type:"primary",style:{"margin-left":"20px"},"html-type":"submit"},{default:c((()=>[U])),_:1})])),_:1})])),_:1},16,["model"])])),_:1},8,["modalVisible"])}}},I={class:"flex form-container"},A={class:"flex-base form-container-item"},N=w("p",null,"Tip: 迁移/复制功能需要至少添加两个面板地址才能正常使用",-1),S=w("p",null,"迁移: 将A面板的所有变量迁移到B面板, 迁移完成后会清空A面板变量 ",-1),B=w("p",null,"复制: 将A面板的所有变量复制到B面板, 复制完成后A面板变量不会变化",-1),L=_("迁移"),T=_("复制"),q={class:"flex-base form-right form-container-item"},P=w("p",null,"Tip: 备份/恢复功能将会以JSON文件实现",-1),V=w("p",null,"备份: 备份完成后会自动下载备份文件，下载完成十秒后。服务器自动删除服务端备份数据",-1),z=_("恢复: 恢复文件的文件名必须为"),J=_("【backup.json】"),R=_("备份"),W=_("恢复"),Y=w("p",null,"Tip: 错误日志会显示以上功能执行时发生的错误记录（只显示最新的十条记录）",-1),E={__name:"index",setup(a){const t=d({start:"",end:""}),n=d({type:"1"}),u=g([]),f=(e,a)=>a.label.indexOf(e)>=0,v={labelCol:{span:6},wrapperCol:{span:16}},_={labelCol:{span:4},wrapperCol:{span:18}},C=[{title:"发生时间",dataIndex:"UserID"},{title:"任务名称",dataIndex:"Username"},{title:"错误记录",dataIndex:"UserWxpusher"}],k=g([]),O=g({}),U=g(!1),E=()=>{U.value=!0,O.value=n},G=()=>{o({data:t}).then((()=>{D.success("操作已进入任务队列, 请稍后前往青龙面板查看结果!")}))},H=()=>{i({data:t}).then((()=>{D.success("操作已进入任务队列, 请稍后前往青龙面板查看结果!")}))},K=()=>{r({data:n}).then((()=>{D.success("操作已进入任务队列, 完成后将自动下载备份文件!"),p()}))},M=()=>{s().then((e=>{k.value=e||[]}))};return l({data:{},splicingData:{page:1,quantity:100}}).then((e=>{u.value=e.pageData.map((e=>({label:e.PanelName,value:e.ID,envData:e.env_data}))),t.start=u.value[0].value,n.start=u.value[0].value;try{t.end=u.value[1].value}catch(a){t.end=u.value[0].value}})),(a,l)=>{const s=h("a-card"),o=h("a-select"),i=h("a-form-item"),r=h("a-col"),p=h("a-row"),d=h("a-divider"),g=h("a-button"),D=h("a-form");return m(),y(x,null,[b(F,{visible:U.value,"onUpdate:visible":l[0]||(l[0]=e=>U.value=e),dataObj:O.value},null,8,["visible","dataObj"]),b(e,{isScroll:"",isNoYScroll:"",isTable:"",isNoPagination:"",columns:C,onInitData:M,dataSource:k.value},{top:c((()=>[w("div",I,[w("div",A,[b(s,{title:"迁移/复制",bordered:!1},{default:c((()=>[N,S,B])),_:1}),b(D,j({model:t},v),{default:c((()=>[b(p,null,{default:c((()=>[b(r,{span:11},{default:c((()=>[b(i,{label:"面板A:",name:"start"},{default:c((()=>[b(o,{value:t.start,"onUpdate:value":l[1]||(l[1]=e=>t.start=e),placeholder:"请选择","filter-option":f,"show-search":"","option-label-prop":"label",options:u.value},null,8,["value","options"])])),_:1})])),_:1}),b(r,{span:11},{default:c((()=>[b(i,{label:"面板B:",name:"end"},{default:c((()=>[b(o,{value:t.end,"onUpdate:value":l[2]||(l[2]=e=>t.end=e),placeholder:"请选择","filter-option":f,"show-search":"","option-label-prop":"label",options:u.value},null,8,["value","options"])])),_:1})])),_:1})])),_:1}),b(d),b(i,{"wrapper-col":{span:20,offset:2},class:"form-buttom flex"},{default:c((()=>[b(g,{type:"primary",style:{"margin-right":"20px"},class:"flex-base",onClick:G},{default:c((()=>[L])),_:1}),b(g,{type:"primary",class:"flex-base",style:{width:"150px"},onClick:H},{default:c((()=>[T])),_:1})])),_:1})])),_:1},16,["model"])]),w("div",q,[b(s,{title:"备份/恢复",bordered:!1},{default:c((()=>[P,V,w("p",null,[z,b(g,{type:"link",class:"cursor-initial",danger:""},{default:c((()=>[J])),_:1})])])),_:1}),b(D,j({model:n},_),{default:c((()=>[b(i,{label:"操作面板:",style:{"margin-top":"-10px"},name:"start"},{default:c((()=>[b(o,{value:n.start,"onUpdate:value":l[3]||(l[3]=e=>n.start=e),placeholder:"请选择","filter-option":f,"show-search":"","option-label-prop":"label",options:u.value},null,8,["value","options"])])),_:1}),b(d),b(i,{"wrapper-col":{span:20,offset:2},class:"form-buttom"},{default:c((()=>[b(g,{type:"primary",class:"flex-base",style:{"margin-right":"20px"},onClick:K},{default:c((()=>[R])),_:1}),b(g,{type:"primary",class:"flex-base",onClick:E},{default:c((()=>[W])),_:1})])),_:1})])),_:1},16,["model"])])]),b(s,{title:"错误日志",bordered:!1},{default:c((()=>[Y])),_:1})])),_:1},8,["dataSource"])],64)}}};export{E as default};
